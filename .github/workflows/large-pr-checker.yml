# ~~ Generated by projen. To modify, edit .projenrc.ts and run "npx projen".

name: large-pr-checker
on:
  pull_request:
    branches:
      - main
    types:
      - labeled
      - edited
      - opened
      - reopened
      - unlabeled
jobs:
  check:
    name: Check PR size
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    if: ${{ !contains(github.event.pull_request.labels.*.name, 'pr/exempt-size-check') }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - id: fetch_target_branch
        run: git fetch origin main
      - id: get_total_lines_changed
        run: |-
          size=$(git diff --shortstat origin/main ':(exclude)*.md' ':(exclude)*.test.ts' ':(exclude)*.yml' \
                  | awk '{ print $4+$6 }' \
                  | awk -F- '{print $NF}' \
                  | bc)
                  
                  echo "Total lines changed: $size"
                  echo "total_lines_changed=$size" >> $GITHUB_OUTPUT
      - id: comment_pr
        if: ${{ fromJSON(steps.get_total_lines_changed.outputs.total_lines_changed) > fromJSON(1000) }}
        uses: thollander/actions-comment-pull-request@v2
        with:
          comment_tag: pr_size
          mode: recreate
          message: Total lines changed ${{ steps.get_total_lines_changed.outputs.total_lines_changed }} is greater than 1000. Please consider breaking this PR down.
      - id: fail
        if: ${{ fromJSON(steps.get_total_lines_changed.outputs.total_lines_changed) > fromJSON(1000) }}
        run: exit 1
